<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON PRECISION V8 - FINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: { cyan: '#00e5ff', emerald: '#00ffa3', crimson: '#ff0055', amber: '#ffb800' },
                        bg: { dark: '#050505', card: 'rgba(255,255,255,0.05)' }
                    },
                    fontFamily: { mono: ['Courier New', 'monospace'] },
                    animation: { 'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: white; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-grid { transition: all 0.1s; touch-action: manipulation; }
        .btn-grid:active { transform: scale(0.95); }
        .red-num { background: rgba(220, 38, 38, 0.3); border: 1px solid rgba(220, 38, 38, 0.5); color: #fca5a5; }
        .black-num { background: rgba(75, 85, 99, 0.3); border: 1px solid rgba(75, 85, 99, 0.5); color: #d1d5db; }
        .green-num { background: rgba(5, 150, 105, 0.3); border: 1px solid rgba(5, 150, 105, 0.5); color: #6ee7b7; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 10px; z-index: 100; animation: slideIn 0.3s; display: none; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-left-color: #00e5ff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen p-4 font-sans selection:bg-neon-cyan/30">

    <div class="max-w-5xl mx-auto space-y-6 pb-32">
        
        <!-- HEADER -->
        <header class="glass rounded-2xl p-6 relative overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <i data-lucide="cpu" class="text-neon-cyan w-8 h-8"></i>
                    <div>
                        <h1 class="text-2xl font-bold tracking-widest">NEON <span class="text-neon-cyan">V8</span></h1>
                        <p class="text-xs text-gray-500 uppercase tracking-[0.2em]" id="game-mode-label">SISTEMA RULETA</p>
                    </div>
                </div>
                <button onclick="toggleSettings()" class="p-3 bg-white/10 rounded-xl hover:bg-white/20 border border-white/10"><i data-lucide="settings"></i></button>
            </div>

            <!-- STATS -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="glass p-4 rounded-xl">
                    <p class="text-xs text-gray-500 mb-1">BALANCE</p>
                    <p class="text-2xl font-mono font-bold text-neon-cyan" id="display-balance">$1000</p>
                </div>
                <div class="glass p-4 rounded-xl border-l-2 border-neon-emerald">
                    <p class="text-xs text-gray-500 mb-1">META</p>
                    <p class="text-xl font-mono text-white" id="display-target">$1500</p>
                </div>
                <div class="glass p-4 rounded-xl border-l-2 border-neon-crimson">
                    <p class="text-xs text-gray-500 mb-1">STOP LOSS</p>
                    <p class="text-xl font-mono text-white" id="display-stop">$500</p>
                </div>
                <div class="glass p-4 rounded-xl bg-neon-amber/10 border border-neon-amber/30">
                    <p class="text-xs text-neon-amber mb-1 font-bold">APUESTA SUGERIDA</p>
                    <p class="text-2xl font-bold text-white" id="display-bet">$0</p>
                    <p class="text-[10px] text-gray-400" id="display-strategy-name">D'Alembert Nivel 1</p>
                </div>
            </div>

            <!-- PROGRESS BAR -->
            <div class="mt-6">
                <div class="flex justify-between text-xs mb-1 font-bold text-neon-cyan">
                    <span id="status-text">RECOLECTANDO DATOS</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="h-1.5 w-full bg-gray-900 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-neon-cyan transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- SETTINGS MODAL -->
        <div id="settings-panel" class="glass p-6 rounded-2xl hidden mb-6 border-l-4 border-neon-amber animate-pulse-fast">
            <h3 class="text-neon-amber font-bold mb-4 flex items-center gap-2"><i data-lucide="key"></i> CONFIGURACIÓN VITAL</h3>
            
            <div class="mb-6">
                <label class="text-xs text-neon-cyan font-bold block mb-2">PEGAR API KEY DE GEMINI AQUÍ:</label>
                <input type="text" id="input-api-key" class="w-full bg-black border border-neon-cyan/50 rounded-xl p-4 text-white text-sm focus:outline-none focus:border-neon-cyan" placeholder="AIzaSy...">
                <p class="text-[10px] text-gray-500 mt-1">La clave se guarda solo en tu dispositivo.</p>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="text-xs text-gray-400">Capital</label>
                    <input type="number" id="input-initial" class="w-full bg-white/5 border border-white/20 rounded p-2 text-white">
                </div>
                <div>
                    <label class="text-xs text-gray-400">Meta</label>
                    <input type="number" id="input-target" class="w-full bg-white/5 border border-white/20 rounded p-2 text-white">
                </div>
                <div>
                    <label class="text-xs text-gray-400">Stop</label>
                    <input type="number" id="input-stop" class="w-full bg-white/5 border border-white/20 rounded p-2 text-white">
                </div>
            </div>
            <button onclick="saveSettings()" class="w-full bg-neon-emerald text-black py-3 rounded-xl font-bold hover:bg-emerald-400 transition-all">GUARDAR Y CONECTAR</button>
        </div>

        <!-- GAME SWITCHER -->
        <div class="grid grid-cols-2 gap-4">
            <button onclick="switchGame('roulette')" id="btn-mode-roulette" class="p-4 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan transition-all flex items-center justify-center gap-2"><i data-lucide="dice-5"></i> RULETA</button>
            <button onclick="switchGame('baccarat')" id="btn-mode-baccarat" class="p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all flex items-center justify-center gap-2"><i data-lucide="spade"></i> BACCARAT</button>
        </div>

        <!-- AI SECTION (AUTOMÁTICA) -->
        <div class="glass p-6 rounded-2xl border border-white/10 relative overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold flex items-center gap-2 text-white"><i data-lucide="brain-circuit"></i> PREDICCIÓN IA</h3>
                <span id="ai-status" class="text-xs font-mono text-gray-500">ESPERANDO DATOS...</span>
            </div>
            
            <!-- RESULTADO IA -->
            <div id="ai-result-container" class="hidden text-center py-4">
                <div class="text-sm text-gray-400 mb-1">LA IA SUGIERE:</div>
                <div id="ai-prediction-text" class="text-4xl font-black text-white mb-2 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">---</div>
                <div class="flex justify-center gap-4 mb-3">
                    <div class="bg-white/10 px-3 py-1 rounded border border-white/10">
                        <span class="text-xs text-gray-400">PROBABILIDAD</span><br>
                        <span id="ai-confidence" class="text-xl font-bold text-neon-cyan">0%</span>
                    </div>
                </div>
                <p id="ai-analysis" class="text-xs text-gray-400 italic border-t border-white/10 pt-2">...</p>
                
                <!-- Botones de Confirmación de Predicción -->
                <div id="prediction-confirmation" class="mt-4 p-3 bg-neon-cyan/10 border border-neon-cyan/30 rounded-xl animate-pulse-fast">
                    <p class="text-xs font-bold text-neon-cyan mb-2">¿APOSTASTE A ESTO?</p>
                    <div class="flex gap-2 justify-center">
                        <span class="text-xs text-gray-300">Marca el resultado abajo para validar</span>
                    </div>
                </div>
            </div>

            <!-- BOTÓN CONSULTAR -->
            <button onclick="callGeminiAuto()" id="btn-consult-ai" class="w-full py-4 rounded-xl font-bold bg-white/5 text-gray-500 border border-white/10 cursor-not-allowed flex justify-center gap-2 items-center transition-all" disabled>
                <span id="btn-ai-text">RECOLECTANDO DATOS...</span>
            </button>
        </div>

        <!-- GAME INPUTS -->
        <div id="game-roulette" class="glass p-6 rounded-2xl">
            <div class="grid grid-cols-6 gap-2" id="roulette-grid"></div>
            <div class="mt-4 flex gap-1 overflow-x-auto pb-2" id="roulette-history"></div>
            
            <!-- BOTÓN CAMBIO CRUPIER -->
            <button onclick="resetDealer()" class="w-full mt-4 py-3 bg-neon-amber/10 border border-neon-amber/50 text-neon-amber rounded-xl font-bold flex items-center justify-center gap-2">
                <i data-lucide="rotate-ccw"></i> CAMBIO DE CRUPIER (RECALIBRAR)
            </button>
        </div>

        <div id="game-baccarat" class="glass p-6 rounded-2xl hidden">
            <div class="grid grid-cols-3 gap-4 h-32">
                <button onclick="registerBaccarat('P')" class="bg-blue-600 border-b-4 border-blue-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">P</button>
                <button onclick="registerBaccarat('B')" class="bg-red-600 border-b-4 border-red-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">B</button>
                <button onclick="registerBaccarat('T')" class="bg-emerald-600 border-b-4 border-emerald-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">T</button>
            </div>
            <div class="mt-4 flex gap-2 overflow-x-auto pb-2" id="baccarat-history"></div>

            <!-- BOTÓN NUEVO SHOE -->
            <button onclick="resetDealer()" class="w-full mt-4 py-3 bg-neon-amber/10 border border-neon-amber/50 text-neon-amber rounded-xl font-bold flex items-center justify-center gap-2">
                <i data-lucide="layers"></i> NUEVO SHOE (RECALIBRAR)
            </button>
        </div>

    </div>

    <!-- TOAST -->
    <div id="toast" class="toast bg-slate-800 border border-neon-cyan text-white font-bold"></div>

    <script>
        // --- ESTADO GLOBAL ---
        let state = {
            apiKey: '',
            activeGame: 'roulette',
            roulette: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                level: 1, // D'Alembert Level
                losses: 0,
                activePrediction: null,
                status: 'collecting', 
                counter: 0
            },
            baccarat: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                step: 0, // 1-3-2-4 Step (0=1, 1=3, 2=2, 3=4)
                losses: 0,
                activePrediction: null,
                status: 'collecting',
                counter: 0
            }
        };

        const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        const SEQ_1324 = [1, 3, 2, 4];

        function init() {
            loadState();
            renderRouletteGrid();
            updateUI();
            lucide.createIcons();
        }

        // --- LÓGICA DE JUEGO ---
        function registerRoulette(num) {
            const s = state.roulette;
            s.history.push(num);
            if (s.history.length > 37) s.history.shift();

            processStateLogic(s, 37);

            // Verificar Predicción y Gestionar Dinero
            if (s.activePrediction !== null) {
                const dozen = getDozen(num);
                const bet = calculateBetAmount(s, 'roulette');
                
                if (dozen === s.activePrediction) {
                    if (s.status === 'active') {
                        s.bankroll.current += bet * 2; // Paga 2:1
                        s.level = Math.max(1, s.level - 1); // D'Alembert: Baja nivel al ganar
                    }
                    s.losses = 0;
                    showToast(`✅ ACIERTO! ${s.status === 'active' ? '+$'+(bet*2).toFixed(0) : '(Virtual)'}`, 'success');
                } else {
                    if (s.status === 'active') {
                        s.bankroll.current -= bet;
                        s.level = Math.min(10, s.level + 1); // D'Alembert: Sube nivel al perder
                    }
                    s.losses++;
                    showToast(`❌ FALLO ${s.status === 'active' ? '-$'+bet.toFixed(0) : '(Virtual)'}`, 'error');
                    
                    if (s.losses >= 3) { 
                        triggerCalibration(s);
                        showToast('⚠️ 3 FALLOS - RECALIBRANDO', 'warning');
                    }
                }
                s.activePrediction = null;
                document.getElementById('ai-result-container').classList.add('hidden');
            }

            saveState();
            updateUI();
        }

        function registerBaccarat(side) {
            const s = state.baccarat;
            s.history.push(side);
            if (s.history.length > 20) s.history.shift();

            processStateLogic(s, 15);

            if (s.activePrediction !== null) {
                const bet = calculateBetAmount(s, 'baccarat');

                if (side === s.activePrediction) {
                    if (s.status === 'active') {
                        s.bankroll.current += bet; // Simplificado 1:1
                        s.step = (s.step + 1) % 4; // 1-3-2-4: Avanza paso
                    }
                    s.losses = 0;
                    showToast(`✅ ACIERTO!`, 'success');
                } else if (side !== 'T') {
                    if (s.status === 'active') {
                        s.bankroll.current -= bet;
                        s.step = 0; // 1-3-2-4: Reinicia al perder
                    }
                    s.losses++;
                    showToast(`❌ FALLO`, 'error');
                    if (s.losses >= 3) { 
                        triggerCalibration(s);
                        showToast('⚠️ RECALIBRANDO', 'warning');
                    }
                }
                s.activePrediction = null;
                document.getElementById('ai-result-container').classList.add('hidden');
            }

            saveState();
            updateUI();
        }

        function calculateBetAmount(s, game) {
            const baseUnit = s.bankroll.current * 0.01; // 1% del capital
            if (game === 'roulette') {
                return Math.floor(baseUnit * s.level);
            } else {
                return Math.floor(baseUnit * SEQ_1324[s.step % 4]);
            }
        }

        function processStateLogic(s, collectTarget) {
            if (s.status === 'collecting') {
                if (s.history.length >= collectTarget) {
                    s.status = 'ghosting';
                    s.counter = 0;
                }
            } else if (s.status === 'calibrating') {
                s.counter++;
                if (s.counter >= 5) {
                    s.status = 'ghosting';
                    s.counter = 0;
                }
            } else if (s.status === 'ghosting') {
                s.counter++;
                if (s.counter >= 10) {
                    s.status = 'active';
                    s.counter = 0;
                }
            }
        }

        function triggerCalibration(s) {
            s.status = 'calibrating';
            s.counter = 0;
            s.activePrediction = null;
        }

        function resetDealer() {
            if(!confirm("¿Cambio de Crupier/Shoe? Se reiniciará la calibración.")) return;
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.history = [];
            triggerCalibration(s);
            updateUI();
        }

        // --- IA GEMINI (DIRECTA V8) ---
        async function callGeminiAuto() {
            if (!state.apiKey) { alert("⚠️ PEGA TU API KEY EN AJUSTES PRIMERO"); toggleSettings(); return; }
            
            const btn = document.getElementById('btn-consult-ai');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<div class="loader"></div> ANALIZANDO...';
            btn.disabled = true;

            const isRoul = state.activeGame === 'roulette';
            const s = isRoul ? state.roulette : state.baccarat;
            
            // Prompt Simplificado para evitar errores de Code Execution en navegador
            const promptText = isRoul 
                ? `Actúa como experto en ruleta. Historial: ${JSON.stringify(s.history)}. Calcula frecuencias y ley del tercio paso a paso. Responde SOLO este JSON: {"prediction": 1, "probability": 85, "analysis": "Tendencia clara"}. (Prediction es 1, 2 o 3 para docenas).`
                : `Actúa como experto en baccarat. Historial: ${JSON.stringify(s.history)}. Detecta patrones paso a paso. Responde SOLO este JSON: {"prediction": "P", "probability": 80, "analysis": "Racha detectada"}. (Prediction es P o B).`;

            try {
                // Usamos la API estándar sin tools para evitar bloqueos de navegador
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.apiKey.trim()}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: promptText }] }]
                    })
                });

                if (!response.ok) {
                    const err = await response.json();
                    throw new Error(err.error.message);
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                const jsonStr = text.replace(/```json|```/g, '').trim();
                const result = JSON.parse(jsonStr);

                const container = document.getElementById('ai-result-container');
                container.classList.remove('hidden');
                
                const predText = isRoul ? `DOCENA ${result.prediction}` : (result.prediction === 'P' ? 'PLAYER' : 'BANKER');
                document.getElementById('ai-prediction-text').innerText = predText;
                document.getElementById('ai-confidence').innerText = result.probability + '%';
                document.getElementById('ai-analysis').innerText = result.analysis;
                
                // Guardar predicción
                s.activePrediction = result.prediction;
                
                const confColor = result.probability > 75 ? 'text-neon-emerald' : 'text-neon-amber';
                document.getElementById('ai-confidence').className = `text-xl font-bold ${confColor}`;

            } catch (error) {
                console.error(error);
                alert(`Error en IA: ${error.message}. Revisa tu API Key.`);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
                saveState();
                updateUI();
            }
        }

        // --- UI RENDERING ---
        function updateUI() {
            const isRoul = state.activeGame === 'roulette';
            const s = isRoul ? state.roulette : state.baccarat;

            // Visibilidad
            document.getElementById('game-roulette').classList.toggle('hidden', !isRoul);
            document.getElementById('game-baccarat').classList.toggle('hidden', isRoul);
            
            // Botones Modo
            document.getElementById('btn-mode-roulette').className = isRoul ? "p-4 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan transition-all flex items-center justify-center gap-2" : "p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all flex items-center justify-center gap-2";
            document.getElementById('btn-mode-baccarat').className = !isRoul ? "p-4 rounded-xl font-bold border border-neon-emerald bg-neon-emerald/10 text-neon-emerald transition-all flex items-center justify-center gap-2" : "p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all flex items-center justify-center gap-2";

            // Stats
            document.getElementById('game-mode-label').innerText = `SISTEMA ${state.activeGame.toUpperCase()}`;
            document.getElementById('display-balance').innerText = `$${s.bankroll.current.toFixed(0)}`;
            document.getElementById('display-target').innerText = `$${s.bankroll.target}`;
            document.getElementById('display-stop').innerText = `$${s.bankroll.stopLoss}`;
            
            // Mostrar Apuesta Calculada
            const bet = calculateBetAmount(s, state.activeGame);
            document.getElementById('display-bet').innerText = s.status === 'active' ? `$${bet}` : '$0 (Virtual)';
            document.getElementById('display-bet').className = s.status === 'active' ? "text-2xl font-bold text-neon-emerald" : "text-2xl font-bold text-gray-500";
            
            document.getElementById('display-strategy-name').innerText = isRoul 
                ? `D'Alembert Nivel ${s.level}` 
                : `1-3-2-4 Paso ${s.step + 1}`;

            // Estado y Progreso
            let statusText = "", progress = 0, colorClass = "text-gray-400";
            const target = isRoul ? 37 : 15;

            if (s.status === 'collecting') {
                statusText = "RECOLECTANDO";
                progress = (s.history.length / target) * 100;
                colorClass = "text-neon-cyan";
            } else if (s.status === 'calibrating') {
                statusText = `CALIBRANDO (${s.counter}/5)`;
                progress = (s.counter / 5) * 100;
                colorClass = "text-neon-crimson";
            } else if (s.status === 'ghosting') {
                statusText = `FANTASMA (${s.counter}/10)`;
                progress = (s.counter / 10) * 100;
                colorClass = "text-neon-amber";
            } else {
                statusText = "SISTEMA ACTIVO";
                progress = 100;
                colorClass = "text-neon-emerald";
            }

            document.getElementById('status-text').innerText = statusText;
            document.getElementById('status-text').className = `font-bold ${colorClass}`;
            document.getElementById('progress-text').innerText = `${Math.round(progress)}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-bar').className = `h-full transition-all duration-500 ${s.status === 'active' ? 'bg-neon-emerald' : s.status === 'ghosting' ? 'bg-neon-amber' : 'bg-neon-cyan'}`;

            // Botón IA
            const btnAi = document.getElementById('btn-consult-ai');
            const btnText = document.getElementById('btn-ai-text');
            const canConsult = s.status === 'active' || s.status === 'ghosting'; 
            
            btnAi.disabled = !canConsult;
            if (s.status === 'collecting') {
                btnAi.className = "w-full py-4 rounded-xl font-bold bg-white/5 text-gray-500 border border-white/10 cursor-not-allowed flex justify-center gap-2 items-center";
                btnText.innerText = `FALTAN DATOS (${s.history.length}/${target})`;
            } else {
                btnAi.className = "w-full py-4 rounded-xl font-bold bg-white text-black hover:bg-neon-cyan hover:shadow-[0_0_20px_rgba(0,229,255,0.6)] flex justify-center gap-2 items-center transition-all";
                btnText.innerText = "CONSULTAR IA GEMINI";
            }

            // Render History
            renderHistory(s.history, isRoul);
        }

        function renderRouletteGrid() {
            const grid = document.getElementById('roulette-grid');
            grid.innerHTML = `<button onclick="registerRoulette(0)" class="col-span-6 h-10 rounded bg-emerald-900/50 border border-emerald-500/30 text-emerald-400 font-bold btn-grid">0</button>`;
            for (let i = 1; i <= 36; i++) {
                const color = REDS.includes(i) ? 'red-num' : 'black-num';
                grid.innerHTML += `<button onclick="registerRoulette(${i})" class="h-12 rounded font-bold text-lg btn-grid ${color}">${i}</button>`;
            }
        }

        function renderHistory(hist, isRoul) {
            const container = document.getElementById(isRoul ? 'roulette-history' : 'baccarat-history');
            container.innerHTML = '';
            hist.slice().reverse().slice(0, 20).forEach(val => {
                let colorClass = 'bg-gray-700';
                if (isRoul) {
                    if (val === 0) colorClass = 'bg-emerald-600';
                    else if (REDS.includes(val)) colorClass = 'bg-red-600';
                } else {
                    if (val === 'P') colorClass = 'bg-blue-600';
                    else if (val === 'B') colorClass = 'bg-red-600';
                    else colorClass = 'bg-emerald-600';
                }
                container.innerHTML += `<div class="min-w-[30px] h-8 flex items-center justify-center text-xs font-bold rounded ${colorClass} text-white">${val}</div>`;
            });
        }

        function getDozen(n) { return n === 0 ? 0 : n <= 12 ? 1 : n <= 24 ? 2 : 3; }
        function switchGame(mode) { state.activeGame = mode; updateUI(); }
        
        function saveState() { localStorage.setItem('neon_v7', JSON.stringify(state)); }
        function loadState() {
            const saved = localStorage.getItem('neon_v7');
            if (saved) state = JSON.parse(saved);
            document.getElementById('input-api-key').value = state.apiKey || '';
        }
        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); }
        function saveSettings() {
            state.apiKey = document.getElementById('input-api-key').value.trim();
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.bankroll.initial = parseFloat(document.getElementById('input-initial').value) || s.bankroll.initial;
            s.bankroll.current = s.bankroll.initial;
            s.bankroll.target = parseFloat(document.getElementById('input-target').value) || s.bankroll.target;
            s.bankroll.stopLoss = parseFloat(document.getElementById('input-stop').value) || s.bankroll.stopLoss;
            toggleSettings();
            saveState();
            updateUI();
            showToast("Configuración Guardada");
        }
        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.style.borderColor = type === 'error' ? '#ff0055' : type === 'warning' ? '#ffb800' : '#00ffa3';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        init();
    </script>
</body>
</html>
