<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON PRECISION V18 - OFFLINE MASTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            font-family: 'Orbitron', monospace;
        }
        
        body {
            background: #000;
            overflow-x: hidden;
        }
        
        .glass-card {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(6, 182, 212, 0.3);
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.2);
        }
        
        .neon-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }
        
        .neon-border {
            box-shadow: 0 0 15px currentColor, inset 0 0 15px rgba(255, 255, 255, 0.1);
        }
        
        .chip-btn {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .chip-btn:active {
            transform: scale(0.95);
        }
        
        .chip-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        
        .chip-btn:active::before {
            width: 100%;
            height: 100%;
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .number-btn {
            transition: all 0.15s ease;
        }
        
        .number-btn:active {
            transform: scale(0.9);
            box-shadow: 0 0 20px currentColor;
        }
        
        .result-chip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.8rem;
            margin: 2px;
        }
        
        .chip-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px;
        }
        
        .chip-img {
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .chip-img:hover {
            transform: scale(1.1);
        }
        
        .chip-img.selected {
            border-color: #06b6d4;
            box-shadow: 0 0 15px #06b6d4;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- HEADER -->
        <div class="glass-card rounded-2xl p-6 mb-6 text-center">
            <h1 class="text-4xl md:text-5xl font-black text-cyan-400 neon-text mb-2">NEON PRECISION V18</h1>
            <p class="text-emerald-400 text-sm md:text-base">OFFLINE MASTER - ALGORITMO MATEM√ÅTICO PURO</p>
        </div>

        <!-- MODO SELECTOR -->
        <div class="glass-card rounded-2xl p-6 mb-6">
            <div class="grid grid-cols-2 gap-4">
                <button id="modeRoulette" class="p-6 rounded-xl neon-border text-cyan-400 border-2 border-cyan-400 font-bold text-lg md:text-xl hover:bg-cyan-400 hover:text-black transition-all">
                    <i data-lucide="disc" class="w-8 h-8 mx-auto mb-2"></i>
                    RULETA
                </button>
                <button id="modeBaccarat" class="p-6 rounded-xl neon-border text-emerald-400 border-2 border-emerald-400 font-bold text-lg md:text-xl hover:bg-emerald-400 hover:text-black transition-all">
                    <i data-lucide="spade" class="w-8 h-8 mx-auto mb-2"></i>
                    BACCARAT
                </button>
            </div>
        </div>

        <!-- CONFIGURACI√ìN INICIAL -->
        <div id="configPanel" class="glass-card rounded-2xl p-6 mb-6">
            <h2 class="text-2xl font-bold text-white mb-4">CONFIGURACI√ìN</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="text-cyan-400 text-sm mb-2 block">CAPITAL INICIAL</label>
                    <input type="number" id="capitalInput" class="w-full bg-black/50 border-2 border-cyan-400 rounded-lg p-3 text-white text-lg" placeholder="100000">
                </div>
                <div>
                    <label class="text-emerald-400 text-sm mb-2 block">META ($)</label>
                    <input type="number" id="metaInput" class="w-full bg-black/50 border-2 border-emerald-400 rounded-lg p-3 text-white text-lg" placeholder="150000">
                </div>
                <div>
                    <label class="text-red-400 text-sm mb-2 block">STOP LOSS ($)</label>
                    <input type="number" id="stopLossInput" class="w-full bg-black/50 border-2 border-red-400 rounded-lg p-3 text-white text-lg" placeholder="80000">
                </div>
            </div>
            <button id="startBtn" class="w-full mt-4 bg-gradient-to-r from-cyan-500 to-emerald-500 text-black font-bold py-4 rounded-xl text-xl hover:shadow-2xl transition-all">
                INICIAR SESI√ìN
            </button>
        </div>

        <!-- PANEL DE JUEGO -->
        <div id="gamePanel" class="hidden">
            <!-- DASHBOARD -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <p class="text-cyan-400 text-sm mb-1">CAPITAL</p>
                        <p id="currentCapital" class="text-white text-2xl font-bold">$0</p>
                    </div>
                    <div>
                        <p class="text-emerald-400 text-sm mb-1">GANANCIA</p>
                        <p id="profitDisplay" class="text-emerald-400 text-2xl font-bold">$0</p>
                    </div>
                    <div>
                        <p class="text-yellow-400 text-sm mb-1">FASE</p>
                        <p id="phaseDisplay" class="text-yellow-400 text-xl font-bold">RECOLECCI√ìN</p>
                    </div>
                    <div>
                        <p class="text-purple-400 text-sm mb-1">DATOS</p>
                        <p id="dataCount" class="text-purple-400 text-2xl font-bold">0</p>
                    </div>
                </div>
            </div>

            <!-- PREDICCI√ìN -->
            <div id="predictionPanel" class="glass-card rounded-2xl p-6 mb-6 hidden">
                <h2 class="text-2xl font-bold text-cyan-400 mb-4 text-center">AN√ÅLISIS MATEM√ÅTICO</h2>
                <div class="bg-black/50 rounded-xl p-6 mb-4">
                    <div class="text-center mb-4">
                        <p class="text-white text-sm mb-2">PREDICCI√ìN</p>
                        <p id="predictionValue" class="text-4xl font-black text-cyan-400 neon-text">---</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <p class="text-emerald-400 text-sm mb-1">CONFIANZA</p>
                            <p id="confidenceValue" class="text-2xl font-bold text-white">0%</p>
                        </div>
                        <div class="text-center">
                            <p class="text-yellow-400 text-sm mb-1">APUESTA</p>
                            <p id="betValue" class="text-2xl font-bold text-white">ESPERAR</p>
                        </div>
                    </div>
                </div>
                
                <!-- SELECTOR DE FICHAS -->
                <div id="chipSelectorPanel" class="hidden">
                    <p class="text-center text-white mb-3 text-sm">SELECCIONA TUS FICHAS (Click para seleccionar/deseleccionar)</p>
                    <div class="chip-selector" id="chipSelector"></div>
                    <div class="text-center mt-4">
                        <p class="text-cyan-400 text-sm mb-2">TOTAL SELECCIONADO</p>
                        <p id="totalSelected" class="text-3xl font-bold text-white">$0</p>
                    </div>
                </div>
            </div>

            <!-- INPUT PANEL -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 text-center">INGRESO DE RESULTADOS</h3>
                
                <!-- RULETA -->
                <div id="rouletteInput" class="hidden">
                    <div class="grid grid-cols-6 md:grid-cols-9 gap-2 mb-4">
                        <!-- N√∫meros 0-36 generados din√°micamente -->
                    </div>
                </div>

                <!-- BACCARAT -->
                <div id="baccaratInput" class="hidden">
                    <div class="grid grid-cols-3 gap-4">
                        <button class="number-btn bg-blue-600 text-white p-6 rounded-xl font-bold text-xl neon-border border-2 border-blue-400" data-result="P">
                            PLAYER
                        </button>
                        <button class="number-btn bg-red-600 text-white p-6 rounded-xl font-bold text-xl neon-border border-2 border-red-400" data-result="B">
                            BANKER
                        </button>
                        <button class="number-btn bg-green-600 text-white p-6 rounded-xl font-bold text-xl neon-border border-2 border-green-400" data-result="T">
                            TIE
                        </button>
                    </div>
                </div>

                <button id="undoBtn" class="w-full mt-4 bg-yellow-600 text-black font-bold py-3 rounded-xl hover:bg-yellow-500 transition-all">
                    DESHACER √öLTIMO
                </button>
            </div>

            <!-- HISTORIAL -->
            <div class="glass-card rounded-2xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4">HISTORIAL</h3>
                <div id="historyDisplay" class="flex flex-wrap gap-2 min-h-[60px]"></div>
            </div>

            <!-- CONTROLES -->
            <div class="grid grid-cols-2 gap-4">
                <button id="resetShoeBtn" class="glass-card p-4 rounded-xl text-yellow-400 font-bold hover:bg-yellow-400 hover:text-black transition-all">
                    <i data-lucide="refresh-cw" class="w-6 h-6 mx-auto mb-2"></i>
                    CAMBIO CRUPIER/SHOE
                </button>
                <button id="endSessionBtn" class="glass-card p-4 rounded-xl text-red-400 font-bold hover:bg-red-400 hover:text-black transition-all">
                    <i data-lucide="power" class="w-6 h-6 mx-auto mb-2"></i>
                    FINALIZAR SESI√ìN
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CORE ENGINE - NEON PRECISION V18
        // ============================================
        
        class NeonPrecisionEngine {
            constructor() {
                this.mode = null;
                this.phase = 'RECOLECCI√ìN';
                this.history = [];
                this.ghostHistory = [];
                this.ghostPredictions = [];
                this.capital = 0;
                this.initialCapital = 0;
                this.meta = 0;
                this.stopLoss = 0;
                this.consecutiveLosses = 0;
                this.betSequence = [1, 3, 2, 4];
                this.currentBetIndex = 0;
                this.dAlembertLevel = 1;
                this.selectedChips = [];
                
                this.loadState();
            }

            saveState() {
                const state = {
                    mode: this.mode,
                    phase: this.phase,
                    history: this.history,
                    ghostHistory: this.ghostHistory,
                    ghostPredictions: this.ghostPredictions,
                    capital: this.capital,
                    initialCapital: this.initialCapital,
                    meta: this.meta,
                    stopLoss: this.stopLoss,
                    consecutiveLosses: this.consecutiveLosses,
                    currentBetIndex: this.currentBetIndex,
                    dAlembertLevel: this.dAlembertLevel
                };
                localStorage.setItem('neonPrecisionState', JSON.stringify(state));
            }

            loadState() {
                const saved = localStorage.getItem('neonPrecisionState');
                if (saved) {
                    const state = JSON.parse(saved);
                    Object.assign(this, state);
                }
            }

            clearState() {
                localStorage.removeItem('neonPrecisionState');
            }

            setMode(mode) {
                this.mode = mode;
                this.phase = 'RECOLECCI√ìN';
                this.history = [];
                this.ghostHistory = [];
                this.ghostPredictions = [];
                this.consecutiveLosses = 0;
                this.saveState();
            }

            setCapital(capital, meta, stopLoss) {
                this.capital = capital;
                this.initialCapital = capital;
                this.meta = meta;
                this.stopLoss = stopLoss;
                this.saveState();
            }

            addResult(result) {
                if (this.phase === 'RECOLECCI√ìN') {
                    this.history.push(result);
                    
                    const required = this.mode === 'roulette' ? 37 : 15;
                    if (this.history.length >= required) {
                        this.phase = 'CALIBRACI√ìN';
                        this.ghostHistory = [];
                    }
                } else if (this.phase === 'CALIBRACI√ìN') {
                    this.ghostHistory.push(result);
                    
                    const prediction = this.getPrediction();
                    this.ghostPredictions.push({
                        predicted: prediction.value,
                        actual: result,
                        correct: this.checkPrediction(prediction.value, result)
                    });
                    
                    if (this.ghostHistory.length >= 10) {
                        const accuracy = this.calculateGhostAccuracy();
                        const currentConfidence = this.getPrediction().confidence;
                        
                        if (accuracy >= 60 && currentConfidence >= 75) {
                            this.phase = 'FUEGO_REAL';
                            this.consecutiveLosses = 0;
                        } else {
                            this.history.push(result);
                        }
                    }
                } else if (this.phase === 'FUEGO_REAL') {
                    const prediction = this.getPrediction();
                    const won = this.checkPrediction(prediction.value, result);
                    
                    this.history.push(result);
                    
                    if (won) {
                        const betAmount = this.calculateBetAmount();
                        const profit = this.calculateProfit(betAmount, prediction.value);
                        this.capital += profit;
                        this.consecutiveLosses = 0;
                        
                        if (this.mode === 'baccarat') {
                            this.currentBetIndex = Math.min(this.currentBetIndex + 1, 3);
                        } else {
                            this.dAlembertLevel = Math.max(1, this.dAlembertLevel - 1);
                        }
                    } else {
                        const betAmount = this.calculateBetAmount();
                        this.capital -= betAmount;
                        this.consecutiveLosses++;
                        
                        if (this.mode === 'baccarat') {
                            this.currentBetIndex = 0;
                        } else {
                            this.dAlembertLevel++;
                        }
                        
                        if (this.consecutiveLosses >= 3) {
                            this.phase = 'RECALIBRACI√ìN';
                            this.ghostHistory = [];
                            this.ghostPredictions = [];
                        }
                    }
                    
                    if (this.capital >= this.meta) {
                        alert('üéâ META ALCANZADA! Has logrado tu objetivo.');
                    }
                    if (this.capital <= this.stopLoss) {
                        alert('‚ö†Ô∏è STOP LOSS ACTIVADO! Det√©n las operaciones.');
                    }
                } else if (this.phase === 'RECALIBRACI√ìN') {
                    this.ghostHistory.push(result);
                    
                    const prediction = this.getPrediction();
                    this.ghostPredictions.push({
                        predicted: prediction.value,
                        actual: result,
                        correct: this.checkPrediction(prediction.value, result)
                    });
                    
                    if (this.ghostHistory.length >= 10) {
                        const accuracy = this.calculateGhostAccuracy();
                        const currentConfidence = this.getPrediction().confidence;
                        
                        if (accuracy >= 60 && currentConfidence >= 75) {
                            this.phase = 'FUEGO_REAL';
                            this.consecutiveLosses = 0;
                        } else {
                            this.history.push(result);
                        }
                    }
                }
                
                this.saveState();
            }

            checkPrediction(predicted, actual) {
                if (this.mode === 'roulette') {
                    if (actual === 0) return false;
                    
                    if (typeof predicted === 'string' && predicted.includes('DOCENA')) {
                        const dozen = parseInt(predicted.split(' ')[1]);
                        if (dozen === 1) return actual >= 1 && actual <= 12;
                        if (dozen === 2) return actual >= 13 && actual <= 24;
                        if (dozen === 3) return actual >= 25 && actual <= 36;
                    }
                    return predicted === actual;
                } else {
                    if (actual === 'T') return false;
                    return predicted === actual;
                }
            }

            calculateGhostAccuracy() {
                if (this.ghostPredictions.length === 0) return 0;
                const correct = this.ghostPredictions.filter(p => p.correct).length;
                return (correct / this.ghostPredictions.length) * 100;
            }

            getPrediction() {
                if (this.mode === 'roulette') {
                    return this.analyzeRoulette();
                } else {
                    return this.analyzeBaccarat();
                }
            }

            analyzeRoulette() {
                const recentData = [...this.history, ...this.ghostHistory].slice(-37);
                
                if (recentData.length < 20) {
                    return { value: null, confidence: 0 };
                }

                const dozens = { 1: 0, 2: 0, 3: 0 };
                
                recentData.forEach(num => {
                    if (num >= 1 && num <= 12) dozens[1]++;
                    else if (num >= 13 && num <= 24) dozens[2]++;
                    else if (num >= 25 && num <= 36) dozens[3]++;
                });

                const expected = recentData.filter(n => n !== 0).length / 3;
                let maxDeviation = 0;
                let bestDozen = 1;

                for (let i = 1; i <= 3; i++) {
                    const deviation = dozens[i] - expected;
                    if (deviation > maxDeviation) {
                        maxDeviation = deviation;
                        bestDozen = i;
                    }
                }

                const confidence = Math.min(95, 50 + (maxDeviation / expected) * 100);

                return {
                    value: `DOCENA ${bestDozen}`,
                    confidence: Math.round(confidence),
                    type: 'dozen'
                };
            }

            analyzeBaccarat() {
                const recentData = [...this.history, ...this.ghostHistory].slice(-15);
                
                if (recentData.length < 8) {
                    return { value: null, confidence: 0 };
                }

                const patterns = this.detectBaccaratPatterns(recentData);
                const count = { P: 0, B: 0, T: 0 };
                recentData.forEach(r => count[r]++);

                let prediction = null;
                let confidence = 0;

                const lastThree = recentData.slice(-3);
                if (lastThree.every(r => r === 'P')) {
                    prediction = 'B';
                    confidence = 75;
                } else if (lastThree.every(r => r === 'B')) {
                    prediction = 'P';
                    confidence = 75;
                } else {
                    const zigzag = this.isZigZag(recentData.slice(-6));
                    if (zigzag) {
                        const last = recentData[recentData.length - 1];
                        prediction = last === 'P' ? 'B' : 'P';
                        confidence = 80;
                    } else {
                        if (count.P < count.B) {
                            prediction = 'P';
                            confidence = 65;
                        } else {
                            prediction = 'B';
                            confidence = 65;
                        }
                    }
                }

                return {
                    value: prediction,
                    confidence: Math.round(confidence),
                    type: 'side'
                };
            }

            detectBaccaratPatterns(data) {
                return {
                    zigzag: this.isZigZag(data),
                    streak: this.detectStreak(data)
                };
            }

            isZigZag(data) {
                if (data.length < 4) return false;
                for (let i = 0; i < data.length - 1; i++) {
                    if (data[i] === data[i + 1]) return false;
                }
                return true;
            }

            detectStreak(data) {
                let current = data[data.length - 1];
                let count = 1;
                for (let i = data.length - 2; i >= 0; i--) {
                    if (data[i] === current) count++;
                    else break;
                }
                return count;
            }

            calculateBetAmount() {
                const baseUnit = this.capital * 0.01;
                
                if (this.mode === 'roulette') {
                    return Math.round(baseUnit * this.dAlembertLevel);
                } else {
                    return Math.round(baseUnit * this.betSequence[this.currentBetIndex]);
                }
            }

            calculateProfit(betAmount, prediction) {
                if (this.mode === 'roulette') {
                    return betAmount * 2;
                } else {
                    if (prediction === 'P') {
                        return betAmount * 1.0;
                    } else {
                        return betAmount * 0.95;
                    }
                }
            }

            undoLast() {
                if (this.phase === 'RECOLECCI√ìN' && this.history.length > 0) {
                    this.history.pop();
                } else if (this.phase === 'CALIBRACI√ìN' && this.ghostHistory.length > 0) {
                    this.ghostHistory.pop();
                    this.ghostPredictions.pop();
                } else if ((this.phase === 'FUEGO_REAL' || this.phase === 'RECALIBRACI√ìN') && this.history.length > 0) {
                    this.history.pop();
                }
                this.saveState();
            }

            resetShoe() {
                const currentCapital = this.capital;
                this.history = [];
                this.ghostHistory = [];
                this.ghostPredictions = [];
                this.phase = 'RECOLECCI√ìN';
                this.consecutiveLosses = 0;
                this.currentBetIndex = 0;
                this.dAlembertLevel = 1;
                this.capital = currentCapital;
                this.saveState();
            }

            getChipRecommendation(betAmount) {
                const chips = this.mode === 'baccarat' 
                    ? [500, 2500, 5000, 25000, 100000, 500000, 1000000, 5000000]
                    : [5, 25, 100, 500, 1000, 5000, 25000, 100000];
                
                let remaining = betAmount;
                const selected = [];
                
                for (let i = chips.length - 1; i >= 0; i--) {
                    while (remaining >= chips[i]) {
                        selected.push(chips[i]);
                        remaining -= chips[i];
                    }
                }
                
                return selected;
            }
        }

        // ============================================
        // UI CONTROLLER
        // ============================================

        const engine = new NeonPrecisionEngine();
        let currentMode = null;

        const rouletteChips = [
            { value: 5, color: '#DC143C', label: '5' },
            { value: 25, color: '#228B22', label: '25' },
            { value: 100, color: '#000080', label: '100' },
            { value: 500, color: '#800080', label: '500' },
            { value: 1000, color: '#FFD700', label: '1K' },
            { value: 5000, color: '#FF8C00', label: '5K' },
            { value: 25000, color: '#8B4513', label: '25K' },
            { value: 100000, color: '#4169E1', label: '100K' }
        ];

        const baccaratChips = [
            { value: 500, color: '#4B0082', label: '500' },
            { value: 2500, color: '#808080', label: '2.5K' },
            { value: 5000, color: '#DAA520', label: '5K' },
            { value: 25000, color: '#DC143C', label: '25K' },
            { value: 100000, color: '#006B7D', label: '100K' },
            { value: 500000, color: '#2F4F4F', label: '500K' },
            { value: 1000000, color: '#8B008B', label: '1M' },
            { value: 5000000, color: '#1E90FF', label: '5M' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            
            if (engine.mode) {
                showGamePanel();
                selectMode(engine.mode);
            }
            
            setupEventListeners();
            generateRouletteNumbers();
        });

        function setupEventListeners() {
            document.getElementById('modeRoulette').addEventListener('click', () => {
                currentMode = 'roulette';
                document.getElementById('modeRoulette').classList.add('bg-cyan-400', 'text-black');
                document.getElementById('modeBaccarat').classList.remove('bg-emerald-400', 'text-black');
            });

            document.getElementById('modeBaccarat').addEventListener('click', () => {
                currentMode = 'baccarat';
                document.getElementById('modeBaccarat').classList.add('bg-emerald-400', 'text-black');
                document.getElementById('modeRoulette').classList.remove('bg-cyan-400', 'text-black');
            });

            document.getElementById('startBtn').addEventListener('click', startSession);
            document.getElementById('undoBtn').addEventListener('click', undoLast);
            document.getElementById('resetShoeBtn').addEventListener('click', resetShoe);
            document.getElementById('endSessionBtn').addEventListener('click', endSession);

            document.querySelectorAll('#baccaratInput .number-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const result = e.target.dataset.result || e.target.parentElement.dataset.result;
                    addResult(result);
                });
            });
        }

        function generateRouletteNumbers() {
            const container = document.querySelector('#rouletteInput .grid');
            const rouletteLayout = [
                { num: 0, color: 'bg-green-600' },
                ...Array.from({length: 36}, (_, i) => ({
                    num: i + 1,
                    color: [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(i + 1) ? 'bg-red-600' : 'bg-gray-800'
                }))
            ];

            rouletteLayout.forEach(({num, color}) => {
                const btn = document.createElement('button');
                btn.className = `number-btn ${color} text-white p-4 rounded-lg font-bold text-lg neon-border border-2`;
                btn.textContent = num;
                btn.addEventListener('click', () => addResult(num));
                container.appendChild(btn);
            });
        }

        function startSession() {
            if (!currentMode) {
                alert('Selecciona un modo primero (Ruleta o Baccarat)');
                return;
            }

            const capital = parseFloat(document.getElementById('capitalInput').value);
            const meta = parseFloat(document.getElementById('metaInput').value);
            const stopLoss = parseFloat(document.getElementById('stopLossInput').value);

            if (!capital || !meta || !stopLoss) {
                alert('Completa todos los campos de configuraci√≥n');
                return;
            }

            engine.setMode(currentMode);
            engine.setCapital(capital, meta, stopLoss);
            
            showGamePanel();
            selectMode(currentMode);
        }

        function showGamePanel() {
            document.getElementById('configPanel').classList.add('hidden');
            document.getElementById('gamePanel').classList.remove('hidden');
            updateDashboard();
        }

        function selectMode(mode) {
            if (mode === 'roulette') {
                document.getElementById('rouletteInput').classList.remove('hidden');
                document.getElementById('baccaratInput').classList.add('hidden');
            } else {
                document.getElementById('rouletteInput').classList.add('hidden');
                document.getElementById('baccaratInput').classList.remove('hidden');
            }
        }

        function addResult(result) {
            engine.addResult(result);
            updateUI();
        }

        function undoLast() {
            engine.undoLast();
            updateUI();
        }

        function resetShoe() {
            if (confirm('¬øCambiar crupier/shoe? Esto reiniciar√° el historial pero mantendr√° el capital.')) {
                engine.resetShoe();
                updateUI();
            }
        }

        function endSession() {
            if (confirm('¬øFinalizar sesi√≥n? Se borrar√°n todos los datos.')) {
                engine.clearState();
                location.reload();
            }
        }

        function updateUI() {
            updateDashboard();
            updateHistory();
            updatePrediction();
        }

        function updateDashboard() {
            document.getElementById('currentCapital').textContent = `${engine.capital.toLocaleString()}`;
            
            const profit = engine.capital - engine.initialCapital;
            const profitEl = document.getElementById('profitDisplay');
            profitEl.textContent = `${profit.toLocaleString()}`;
            profitEl.className = profit >= 0 ? 'text-emerald-400 text-2xl font-bold' : 'text-red-400 text-2xl font-bold';
            
            document.getElementById('phaseDisplay').textContent = engine.phase;
            
            const totalData = engine.history.length + engine.ghostHistory.length;
            document.getElementById('dataCount').textContent = totalData;
        }

        function updateHistory() {
            const container = document.getElementById('historyDisplay');
            const allData = [...engine.history, ...engine.ghostHistory];
            
            container.innerHTML = allData.slice(-20).map((result, idx) => {
                if (engine.mode === 'roulette') {
                    const color = result === 0 ? '#22c55e' : 
                                 [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(result) ? '#dc2626' : '#1f2937';
                    return `<div class="result-chip slide-in" style="background: ${color}; border: 2px solid #fff;">${result}</div>`;
                } else {
                    const colors = { P: '#3b82f6', B: '#dc2626', T: '#22c55e' };
                    const labels = { P: 'P', B: 'B', T: 'T' };
                    return `<div class="result-chip slide-in" style="background: ${colors[result]}; border: 2px solid #fff;">${labels[result]}</div>`;
                }
            }).join('');
        }

        function updatePrediction() {
            const prediction = engine.getPrediction();
            const panel = document.getElementById('predictionPanel');
            
            if (engine.phase === 'RECOLECCI√ìN') {
                panel.classList.add('hidden');
                return;
            }
            
            panel.classList.remove('hidden');
            
            document.getElementById('predictionValue').textContent = prediction.value || '---';
            document.getElementById('confidenceValue').textContent = `${prediction.confidence}%`;
            
            if (engine.phase === 'FUEGO_REAL' && prediction.confidence >= 75) {
                const betAmount = engine.calculateBetAmount();
                document.getElementById('betValue').textContent = `${betAmount.toLocaleString()}`;
                
                showChipSelector(betAmount);
            } else {
                document.getElementById('betValue').textContent = 'ESPERAR';
                document.getElementById('chipSelectorPanel').classList.add('hidden');
            }
        }

        function showChipSelector(betAmount) {
            const panel = document.getElementById('chipSelectorPanel');
            const container = document.getElementById('chipSelector');
            const chips = engine.mode === 'roulette' ? rouletteChips : baccaratChips;
            
            panel.classList.remove('hidden');
            
            const recommended = engine.getChipRecommendation(betAmount);
            
            container.innerHTML = chips.map(chip => {
                const count = recommended.filter(c => c === chip.value).length;
                const isRecommended = count > 0;
                
                return `
                    <div class="text-center">
                        <div class="chip-img ${isRecommended ? 'selected' : ''}" 
                             data-value="${chip.value}"
                             style="width: 50px; height: 50px; border-radius: 50%; background: ${chip.color}; 
                                    display: flex; align-items: center; justify-content: center; 
                                    color: white; font-weight: bold; font-size: 0.8rem;
                                    box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                            ${chip.label}
                        </div>
                        ${isRecommended ? `<p class="text-xs text-cyan-400 mt-1">x${count}</p>` : ''}
                    </div>
                `;
            }).join('');
            
            const total = recommended.reduce((sum, val) => sum + val, 0);
            document.getElementById('totalSelected').textContent = `${total.toLocaleString()}`;
            
            container.querySelectorAll('.chip-img').forEach(chip => {
                chip.addEventListener('click', () => {
                    chip.classList.toggle('selected');
                    updateSelectedTotal();
                });
            });
        }

        function updateSelectedTotal() {
            const selected = document.querySelectorAll('.chip-img.selected');
            let total = 0;
            selected.forEach(chip => {
                total += parseInt(chip.dataset.value);
            });
            document.getElementById('totalSelected').textContent = `${total.toLocaleString()}`;
        }

        if (engine.mode) {
            setTimeout(() => {
                showGamePanel();
                selectMode(engine.mode);
                updateUI();
            }, 100);
        }
    </script>
</body>
</html>
