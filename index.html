<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON PRECISION V5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: { cyan: '#00e5ff', emerald: '#00ffa3', crimson: '#ff0055', amber: '#ffb800' },
                        bg: { dark: '#050505', card: 'rgba(255,255,255,0.05)' }
                    },
                    fontFamily: { mono: ['Courier New', 'monospace'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: white; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-grid { transition: all 0.1s; touch-action: manipulation; }
        .btn-grid:active { transform: scale(0.95); }
        .red-num { background: rgba(220, 38, 38, 0.3); border: 1px solid rgba(220, 38, 38, 0.5); color: #fca5a5; }
        .black-num { background: rgba(75, 85, 99, 0.3); border: 1px solid rgba(75, 85, 99, 0.5); color: #d1d5db; }
        .green-num { background: rgba(5, 150, 105, 0.3); border: 1px solid rgba(5, 150, 105, 0.5); color: #6ee7b7; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 10px; z-index: 100; animation: slideIn 0.3s; display: none; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Estilos espec√≠ficos para iPad/M√≥vil */
        input, button { font-size: 16px; } 
    </style>
</head>
<body class="min-h-screen p-4 font-sans selection:bg-neon-cyan/30">

    <div class="max-w-5xl mx-auto space-y-6 pb-20">
        
        <!-- HEADER -->
        <header class="glass rounded-2xl p-6 relative overflow-hidden">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-3">
                    <i data-lucide="activity" class="text-neon-cyan w-8 h-8"></i>
                    <div>
                        <h1 class="text-2xl font-bold tracking-widest">NEON <span class="text-neon-cyan">V5</span></h1>
                        <p class="text-xs text-gray-500 uppercase tracking-[0.2em]" id="game-mode-label">SISTEMA RULETA</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="resetDealer()" class="p-3 bg-neon-amber/20 text-neon-amber rounded-xl hover:bg-neon-amber/40" title="Cambio Crupier"><i data-lucide="rotate-ccw"></i></button>
                    <button onclick="toggleSettings()" class="p-3 bg-white/10 rounded-xl hover:bg-white/20"><i data-lucide="settings"></i></button>
                </div>
            </div>

            <!-- STATS -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="glass p-4 rounded-xl">
                    <p class="text-xs text-gray-500 mb-1">BALANCE</p>
                    <p class="text-2xl font-mono font-bold text-neon-cyan" id="display-balance">$1000</p>
                </div>
                <div class="glass p-4 rounded-xl border-l-2 border-neon-emerald">
                    <p class="text-xs text-gray-500 mb-1">META</p>
                    <p class="text-xl font-mono text-white" id="display-target">$1500</p>
                </div>
                <div class="glass p-4 rounded-xl border-l-2 border-neon-crimson">
                    <p class="text-xs text-gray-500 mb-1">STOP LOSS</p>
                    <p class="text-xl font-mono text-white" id="display-stop">$500</p>
                </div>
                <div class="glass p-4 rounded-xl">
                    <p class="text-xs text-gray-500 mb-1">ESTRATEGIA</p>
                    <p class="text-xl font-bold text-neon-amber" id="display-strategy">Nivel 1</p>
                </div>
            </div>

            <!-- PROGRESS BAR -->
            <div class="mt-6">
                <div class="flex justify-between text-xs mb-1 font-bold text-neon-cyan">
                    <span id="status-text">RECOLECTANDO DATOS</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="h-1.5 w-full bg-gray-900 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-neon-cyan transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- SETTINGS MODAL -->
        <div id="settings-panel" class="glass p-6 rounded-2xl hidden mb-6 border-l-4 border-neon-amber">
            <h3 class="text-neon-amber font-bold mb-4">CONFIGURACI√ìN DE BANCA (INDEPENDIENTE)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="text-xs text-gray-400">Capital Inicial</label>
                    <input type="number" id="input-initial" class="w-full bg-black/50 border border-white/20 rounded p-3 text-white" placeholder="Capital">
                </div>
                <div>
                    <label class="text-xs text-gray-400">Meta</label>
                    <input type="number" id="input-target" class="w-full bg-black/50 border border-white/20 rounded p-3 text-white" placeholder="Meta">
                </div>
                <div>
                    <label class="text-xs text-gray-400">Stop Loss</label>
                    <input type="number" id="input-stop" class="w-full bg-black/50 border border-white/20 rounded p-3 text-white" placeholder="Stop Loss">
                </div>
            </div>
            <button onclick="saveSettings()" class="w-full bg-neon-emerald/20 text-neon-emerald border border-neon-emerald py-3 rounded-xl font-bold hover:bg-neon-emerald/40">GUARDAR CAMBIOS</button>
        </div>

        <!-- GAME SWITCHER -->
        <div class="grid grid-cols-2 gap-4">
            <button onclick="switchGame('roulette')" id="btn-mode-roulette" class="p-4 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan transition-all flex items-center justify-center gap-2"><i data-lucide="dice-5"></i> RULETA</button>
            <button onclick="switchGame('baccarat')" id="btn-mode-baccarat" class="p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all flex items-center justify-center gap-2"><i data-lucide="spade"></i> BACCARAT</button>
        </div>

        <!-- AI SECTION -->
        <div class="glass p-6 rounded-2xl border border-white/10">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold flex items-center gap-2 text-white"><i data-lucide="cpu"></i> MOTOR IA</h3>
                <span id="waiting-prediction" class="hidden bg-neon-amber/20 text-neon-amber px-3 py-1 rounded text-xs font-bold animate-pulse">ESPERANDO RESULTADO</span>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="generatePrompt()" id="btn-gen-prompt" class="py-4 rounded-xl font-bold bg-white/5 text-gray-500 border border-white/10 cursor-not-allowed flex justify-center gap-2 items-center" disabled>
                    <i data-lucide="copy"></i> COPIAR PROMPT
                </button>
                <button onclick="window.open('https://aistudio.google.com/app/prompts/new_chat', '_blank')" class="py-4 rounded-xl font-bold bg-black border border-white/20 text-white hover:bg-white/10 flex justify-center gap-2 items-center">
                    <i data-lucide="external-link"></i> IR A GOOGLE AI
                </button>
            </div>

            <!-- MANUAL PREDICTION INPUT -->
            <div class="bg-black/40 p-4 rounded-xl border border-white/10">
                <p class="text-[10px] text-gray-500 mb-3 uppercase tracking-widest font-bold text-center">REGISTRAR PREDICCI√ìN IA</p>
                <div id="prediction-inputs-roulette" class="flex gap-2">
                    <button onclick="setPrediction(1)" class="flex-1 py-3 bg-white/5 hover:bg-neon-cyan/20 border border-white/10 rounded-lg font-bold text-sm">DOCENA 1</button>
                    <button onclick="setPrediction(2)" class="flex-1 py-3 bg-white/5 hover:bg-neon-cyan/20 border border-white/10 rounded-lg font-bold text-sm">DOCENA 2</button>
                    <button onclick="setPrediction(3)" class="flex-1 py-3 bg-white/5 hover:bg-neon-cyan/20 border border-white/10 rounded-lg font-bold text-sm">DOCENA 3</button>
                </div>
                <div id="prediction-inputs-baccarat" class="flex gap-2 hidden">
                    <button onclick="setPrediction('P')" class="flex-1 py-3 bg-blue-900/20 border-blue-500/30 text-blue-400 rounded-lg font-bold">PLAYER</button>
                    <button onclick="setPrediction('B')" class="flex-1 py-3 bg-red-900/20 border-red-500/30 text-red-400 rounded-lg font-bold">BANKER</button>
                </div>
            </div>
        </div>

        <!-- GAME INPUTS -->
        <div id="game-roulette" class="glass p-6 rounded-2xl">
            <div class="grid grid-cols-6 gap-2" id="roulette-grid">
                <!-- JS generar√° los botones -->
            </div>
            <div class="mt-4 flex gap-1 overflow-x-auto pb-2" id="roulette-history"></div>
        </div>

        <div id="game-baccarat" class="glass p-6 rounded-2xl hidden">
            <div class="grid grid-cols-3 gap-4 h-32">
                <button onclick="registerBaccarat('P')" class="bg-blue-600 border-b-4 border-blue-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">P</button>
                <button onclick="registerBaccarat('B')" class="bg-red-600 border-b-4 border-red-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">B</button>
                <button onclick="registerBaccarat('T')" class="bg-emerald-600 border-b-4 border-emerald-800 text-white font-black text-2xl rounded-xl active:border-b-0 active:translate-y-1">T</button>
            </div>
            <div class="mt-4 flex gap-2 overflow-x-auto pb-2" id="baccarat-history"></div>
        </div>

    </div>

    <!-- TOAST -->
    <div id="toast" class="toast bg-slate-800 border border-neon-cyan text-white font-bold"></div>

    <!-- LOGIC SCRIPT -->
    <script>
        // --- ESTADO GLOBAL ---
        let state = {
            activeGame: 'roulette',
            roulette: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                level: 1,
                losses: 0,
                prediction: null,
                status: 'collecting', // collecting, ghosting, active, calibrating
                ghostCount: 0,
                calibrationCount: 0
            },
            baccarat: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                step: 0, // 1-3-2-4
                losses: 0,
                prediction: null,
                status: 'collecting',
                ghostCount: 0,
                calibrationCount: 0
            }
        };

        const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        const SEQ_1324 = [1, 3, 2, 4];

        // --- INICIALIZACI√ìN ---
        function init() {
            loadState();
            renderRouletteGrid();
            updateUI();
            lucide.createIcons();
        }

        // --- L√ìGICA DE JUEGO ---
        function registerRoulette(num) {
            const s = state.roulette;
            s.history.push(num);
            if (s.history.length > 37) s.history.shift();

            // M√°quina de Estados
            if (s.status === 'collecting' && s.history.length >= 37) {
                s.status = 'ghosting'; s.ghostCount = 0;
            } else if (s.status === 'ghosting') {
                s.ghostCount++;
                if (s.ghostCount >= 10) { s.status = 'active'; s.ghostCount = 0; }
            } else if (s.status === 'calibrating') {
                s.calibrationCount++;
                if (s.calibrationCount >= 5) { s.status = 'active'; s.calibrationCount = 0; s.losses = 0; }
            } else if (s.status === 'active' && s.prediction !== null) {
                // L√≥gica D'Alembert
                const dozen = getDozen(num);
                const bet = s.bankroll.current * 0.01 * s.level;
                
                if (dozen === s.prediction) {
                    s.bankroll.current += bet * 2;
                    s.level = Math.max(1, s.level - 1);
                    s.losses = 0;
                    showToast(`‚úÖ GANASTE! +$${(bet*2).toFixed(2)}`, 'success');
                } else {
                    s.bankroll.current -= bet;
                    s.level = Math.min(10, s.level + 1);
                    s.losses++;
                    showToast(`‚ùå PERDISTE -$${bet.toFixed(2)}`, 'error');
                    if (s.losses >= 3) { s.status = 'calibrating'; s.calibrationCount = 0; showToast('‚ö†Ô∏è RECALIBRANDO', 'warning'); }
                }
                s.prediction = null;
            }

            saveState();
            updateUI();
        }

        function registerBaccarat(side) {
            const s = state.baccarat;
            s.history.push(side);
            if (s.history.length > 20) s.history.shift();

            if (s.status === 'collecting' && s.history.length >= 15) {
                s.status = 'ghosting'; s.ghostCount = 0;
            } else if (s.status === 'ghosting') {
                s.ghostCount++;
                if (s.ghostCount >= 10) { s.status = 'active'; s.ghostCount = 0; }
            } else if (s.status === 'calibrating') {
                s.calibrationCount++;
                if (s.calibrationCount >= 5) { s.status = 'active'; s.calibrationCount = 0; s.losses = 0; }
            } else if (s.status === 'active' && s.prediction !== null) {
                // L√≥gica 1-3-2-4
                const base = s.bankroll.current * 0.01;
                const bet = base * SEQ_1324[s.step % 4];

                if (side === s.prediction) {
                    s.bankroll.current += bet; // Simplificado 1:1
                    s.step = (s.step + 1) % 4;
                    s.losses = 0;
                    showToast(`‚úÖ GANASTE! +$${bet.toFixed(2)}`, 'success');
                } else if (side !== 'T') {
                    s.bankroll.current -= bet;
                    s.step = 0;
                    s.losses++;
                    showToast(`‚ùå PERDISTE -$${bet.toFixed(2)}`, 'error');
                    if (s.losses >= 3) { s.status = 'calibrating'; s.calibrationCount = 0; showToast('‚ö†Ô∏è RECALIBRANDO', 'warning'); }
                }
                s.prediction = null;
            }

            saveState();
            updateUI();
        }

        // --- UTILS ---
        function getDozen(n) { return n === 0 ? 0 : n <= 12 ? 1 : n <= 24 ? 2 : 3; }
        
        function setPrediction(val) {
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.prediction = val;
            updateUI();
            showToast(`üéØ Predicci√≥n registrada: ${val}`);
        }

        function resetDealer() {
            if(!confirm("¬øCambio de Crupier? Se reiniciar√° la calibraci√≥n.")) return;
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.history = [];
            s.status = 'calibrating';
            s.calibrationCount = 0;
            s.prediction = null;
            updateUI();
        }

        function switchGame(mode) {
            state.activeGame = mode;
            updateUI();
        }

        // --- PROMPT GENERATOR ---
        function generatePrompt() {
            const isRoul = state.activeGame === 'roulette';
            const s = isRoul ? state.roulette : state.baccarat;
            const hist = JSON.stringify(s.history);
            const context = s.status === 'ghosting' ? "MODO FANTASMA (No arriesgar)" : "MODO ACTIVO (Fuego Real)";
            
            let prompt = "";
            if (isRoul) {
                prompt = `CONTEXTO: ${context}\nAnaliza estos n√∫meros de ruleta: ${hist}. Usa Python para calcular frecuencias y Chi-cuadrado. Aplica estrategia D'Alembert (Nivel ${s.level}, Balance ${s.bankroll.current}). Si la probabilidad es >75%, dame la docena a apostar. Responde: DOCENA: X, CONFIANZA: X%, APUESTA: $X.`;
            } else {
                prompt = `CONTEXTO: ${context}\nAnaliza estos resultados de Baccarat: ${hist}. Usa Python para detectar patrones. Aplica sistema 1-3-2-4 (Paso ${s.step + 1}, Balance ${s.bankroll.current}). Si la probabilidad es >75%, dame el lado. Responde: LADO: P/B, CONFIANZA: X%, APUESTA: $X.`;
            }

            navigator.clipboard.writeText(prompt).then(() => showToast("‚úÖ Prompt Copiado"));
        }

        // --- UI RENDERING ---
        function updateUI() {
            const isRoul = state.activeGame === 'roulette';
            const s = isRoul ? state.roulette : state.baccarat;

            // Toggle Views
            document.getElementById('game-roulette').classList.toggle('hidden', !isRoul);
            document.getElementById('game-baccarat').classList.toggle('hidden', isRoul);
            document.getElementById('prediction-inputs-roulette').classList.toggle('hidden', !isRoul);
            document.getElementById('prediction-inputs-baccarat').classList.toggle('hidden', isRoul);
            
            // Buttons Style
            document.getElementById('btn-mode-roulette').className = isRoul ? "p-4 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan transition-all" : "p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all";
            document.getElementById('btn-mode-baccarat').className = !isRoul ? "p-4 rounded-xl font-bold border border-neon-emerald bg-neon-emerald/10 text-neon-emerald transition-all" : "p-4 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 transition-all";

            // Stats
            document.getElementById('game-mode-label').innerText = `SISTEMA ${state.activeGame.toUpperCase()}`;
            document.getElementById('display-balance').innerText = `$${s.bankroll.current.toFixed(0)}`;
            document.getElementById('display-target').innerText = `$${s.bankroll.target}`;
            document.getElementById('display-stop').innerText = `$${s.bankroll.stopLoss}`;
            document.getElementById('display-strategy').innerText = isRoul ? `Nivel ${s.level}` : `Paso ${s.step + 1}`;

            // Status & Progress
            let statusText = "", progress = 0, colorClass = "text-gray-400";
            if (s.status === 'collecting') {
                statusText = "RECOLECTANDO";
                progress = (s.history.length / (isRoul ? 37 : 15)) * 100;
                colorClass = "text-neon-cyan";
            } else if (s.status === 'ghosting') {
                statusText = `FANTASMA (${s.ghostCount}/10)`;
                progress = (s.ghostCount / 10) * 100;
                colorClass = "text-neon-amber";
            } else if (s.status === 'calibrating') {
                statusText = `CALIBRANDO (${s.calibrationCount}/5)`;
                progress = (s.calibrationCount / 5) * 100;
                colorClass = "text-neon-crimson";
            } else {
                statusText = "SISTEMA ACTIVO";
                progress = 100;
                colorClass = "text-neon-emerald";
            }

            document.getElementById('status-text').innerText = statusText;
            document.getElementById('status-text').className = `font-bold ${colorClass}`;
            document.getElementById('progress-text').innerText = `${Math.round(progress)}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            // Prompt Button
            const btnPrompt = document.getElementById('btn-gen-prompt');
            const canGen = s.status !== 'calibrating' && (isRoul ? s.history.length >= 37 : s.history.length >= 15);
            btnPrompt.disabled = !canGen;
            btnPrompt.className = canGen ? "py-4 rounded-xl font-bold bg-white text-black hover:bg-neon-cyan flex justify-center gap-2 items-center" : "py-4 rounded-xl font-bold bg-white/5 text-gray-500 border border-white/10 cursor-not-allowed flex justify-center gap-2 items-center";

            // Prediction Indicator
            const predIndicator = document.getElementById('waiting-prediction');
            if (s.prediction) {
                predIndicator.classList.remove('hidden');
                predIndicator.innerText = `ESPERANDO: ${s.prediction}`;
            } else {
                predIndicator.classList.add('hidden');
            }

            // Render History
            renderHistory(s.history, isRoul);
        }

        function renderRouletteGrid() {
            const grid = document.getElementById('roulette-grid');
            grid.innerHTML = `<button onclick="registerRoulette(0)" class="col-span-6 h-10 rounded bg-emerald-900/50 border border-emerald-500/30 text-emerald-400 font-bold btn-grid">0</button>`;
            for (let i = 1; i <= 36; i++) {
                const color = REDS.includes(i) ? 'red-num' : 'black-num';
                grid.innerHTML += `<button onclick="registerRoulette(${i})" class="h-12 rounded font-bold text-lg btn-grid ${color}">${i}</button>`;
            }
        }

        function renderHistory(hist, isRoul) {
            const container = document.getElementById(isRoul ? 'roulette-history' : 'baccarat-history');
            container.innerHTML = '';
            hist.slice().reverse().slice(0, 20).forEach(val => {
                let colorClass = 'bg-gray-700';
                if (isRoul) {
                    if (val === 0) colorClass = 'bg-emerald-600';
                    else if (REDS.includes(val)) colorClass = 'bg-red-600';
                } else {
                    if (val === 'P') colorClass = 'bg-blue-600';
                    else if (val === 'B') colorClass = 'bg-red-600';
                    else colorClass = 'bg-emerald-600';
                }
                container.innerHTML += `<div class="min-w-[30px] h-8 flex items-center justify-center text-xs font-bold rounded ${colorClass} text-white">${val}</div>`;
            });
        }

        // --- STORAGE & SETTINGS ---
        function saveState() { localStorage.setItem('neon_v5', JSON.stringify(state)); }
        function loadState() {
            const saved = localStorage.getItem('neon_v5');
            if (saved) state = JSON.parse(saved);
        }
        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); }
        function saveSettings() {
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.bankroll.initial = parseFloat(document.getElementById('input-initial').value) || s.bankroll.initial;
            s.bankroll.current = s.bankroll.initial; // Reset current on change
            s.bankroll.target = parseFloat(document.getElementById('input-target').value) || s.bankroll.target;
            s.bankroll.stopLoss = parseFloat(document.getElementById('input-stop').value) || s.bankroll.stopLoss;
            toggleSettings();
            saveState();
            updateUI();
            showToast("Configuraci√≥n Guardada");
        }
        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.style.borderColor = type === 'error' ? '#ff0055' : type === 'warning' ? '#ffb800' : '#00ffa3';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        // Start
        init();
    </script>
</body>
</html>
