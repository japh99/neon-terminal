<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON SNIPER V15</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: { cyan: '#00e5ff', emerald: '#00ffa3', crimson: '#ff0055', amber: '#ffb800' },
                        bg: { dark: '#050505', card: 'rgba(255,255,255,0.05)' }
                    },
                    fontFamily: { mono: ['Courier New', 'monospace'] },
                    animation: { 'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: white; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-grid { transition: all 0.05s; touch-action: manipulation; }
        .btn-grid:active { transform: scale(0.95); }
        .red-num { background: rgba(220, 38, 38, 0.3); border: 1px solid rgba(220, 38, 38, 0.5); color: #fca5a5; }
        .black-num { background: rgba(75, 85, 99, 0.3); border: 1px solid rgba(75, 85, 99, 0.5); color: #d1d5db; }
        .green-num { background: rgba(5, 150, 105, 0.3); border: 1px solid rgba(5, 150, 105, 0.5); color: #6ee7b7; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 15px; border-radius: 10px; z-index: 100; animation: slideIn 0.3s; display: none; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body class="min-h-screen p-2 font-sans selection:bg-neon-cyan/30">

    <div class="max-w-5xl mx-auto space-y-4 pb-32">
        
        <!-- HEADER -->
        <header class="glass rounded-2xl p-4 relative overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <i data-lucide="crosshair" class="text-neon-cyan w-6 h-6"></i>
                    <div>
                        <h1 class="text-xl font-bold tracking-widest">SNIPER <span class="text-neon-cyan">V15</span></h1>
                        <p class="text-[10px] text-gray-500 uppercase tracking-[0.2em]" id="game-mode-label">RULETA</p>
                    </div>
                </div>
                <button onclick="toggleSettings()" class="p-2 bg-white/10 rounded-lg hover:bg-white/20 border border-white/10"><i data-lucide="settings" class="w-5 h-5"></i></button>
            </div>

            <!-- STATS -->
            <div class="grid grid-cols-4 gap-2 text-center">
                <div class="glass p-2 rounded-lg">
                    <p class="text-[10px] text-gray-500">BALANCE</p>
                    <p class="text-lg font-mono font-bold text-neon-cyan" id="display-balance">$1000</p>
                </div>
                <div class="glass p-2 rounded-lg border-l-2 border-neon-emerald">
                    <p class="text-[10px] text-gray-500">META</p>
                    <p class="text-lg font-mono text-white" id="display-target">$1500</p>
                </div>
                <div class="glass p-2 rounded-lg border-l-2 border-neon-crimson">
                    <p class="text-[10px] text-gray-500">STOP</p>
                    <p class="text-lg font-mono text-white" id="display-stop">$500</p>
                </div>
                <div class="glass p-2 rounded-lg bg-neon-amber/10 border border-neon-amber/30">
                    <p class="text-[10px] text-neon-amber font-bold">APUESTA</p>
                    <p class="text-lg font-bold text-white" id="display-bet">$0</p>
                </div>
            </div>

            <!-- PROGRESS BAR -->
            <div class="mt-4">
                <div class="flex justify-between text-[10px] mb-1 font-bold text-neon-cyan">
                    <span id="status-text">RECOLECTANDO (0/37)</span>
                    <span id="progress-text">0%</span>
                </div>
                <div class="h-1 w-full bg-gray-900 rounded-full overflow-hidden">
                    <div id="progress-bar" class="h-full bg-neon-cyan transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <!-- SETTINGS MODAL -->
        <div id="settings-panel" class="glass p-6 rounded-2xl hidden mb-6 border-l-4 border-neon-amber animate-pulse-fast">
            <h3 class="text-neon-amber font-bold mb-4 flex items-center gap-2"><i data-lucide="sliders"></i> CONFIGURACIÃ“N</h3>
            <div class="grid grid-cols-3 gap-2 mb-4">
                <input type="number" id="input-initial" class="bg-white/5 border border-white/20 rounded p-2 text-white text-sm" placeholder="Capital">
                <input type="number" id="input-target" class="bg-white/5 border border-white/20 rounded p-2 text-white text-sm" placeholder="Meta">
                <input type="number" id="input-stop" class="bg-white/5 border border-white/20 rounded p-2 text-white text-sm" placeholder="Stop">
            </div>
            <button onclick="saveSettings()" class="w-full bg-neon-emerald text-black py-3 rounded-xl font-bold hover:bg-emerald-400">GUARDAR</button>
        </div>

        <!-- PREDICTION PANEL -->
        <div id="prediction-panel" class="glass p-4 rounded-2xl border border-white/10 hidden">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-sm font-bold text-white flex items-center gap-2"><i data-lucide="target"></i> OBJETIVO</h3>
                <span id="phase-badge" class="text-[10px] bg-neon-amber/20 text-neon-amber px-2 py-1 rounded font-bold">FANTASMA</span>
            </div>
            
            <div class="text-center py-2">
                <div id="pred-main" class="text-4xl font-black text-white mb-1 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">---</div>
                <div class="flex justify-center gap-4">
                    <div class="text-center">
                        <p class="text-[10px] text-gray-400">CONFIANZA</p>
                        <p id="pred-confidence" class="text-lg font-bold text-neon-cyan">0%</p>
                    </div>
                    <div class="text-center">
                        <p class="text-[10px] text-gray-400">ACIERTOS GHOST</p>
                        <p id="pred-ghost-stats" class="text-lg font-bold text-neon-emerald">0/0</p>
                    </div>
                </div>
                <p id="pred-reason" class="text-[10px] text-gray-400 mt-2 italic">Esperando datos...</p>
            </div>
        </div>

        <!-- GAME INPUTS -->
        <div id="game-roulette" class="glass p-4 rounded-2xl">
            <div class="grid grid-cols-6 gap-1" id="roulette-grid"></div>
            <div class="mt-3 flex gap-1 overflow-x-auto pb-1 h-8" id="roulette-history"></div>
            <button onclick="resetDealer()" class="w-full mt-3 py-3 bg-neon-amber/10 border border-neon-amber/50 text-neon-amber rounded-xl font-bold flex items-center justify-center gap-2 text-sm">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> CAMBIO DE CRUPIER
            </button>
        </div>

        <div id="game-baccarat" class="glass p-4 rounded-2xl hidden">
            <div class="grid grid-cols-3 gap-2 h-24">
                <button onclick="registerBaccarat('P')" class="bg-blue-600 border-b-4 border-blue-800 text-white font-black text-xl rounded-xl active:border-b-0 active:translate-y-1">P</button>
                <button onclick="registerBaccarat('B')" class="bg-red-600 border-b-4 border-red-800 text-white font-black text-xl rounded-xl active:border-b-0 active:translate-y-1">B</button>
                <button onclick="registerBaccarat('T')" class="bg-emerald-600 border-b-4 border-emerald-800 text-white font-black text-xl rounded-xl active:border-b-0 active:translate-y-1">T</button>
            </div>
            <div class="mt-3 flex gap-1 overflow-x-auto pb-1 h-8" id="baccarat-history"></div>
            <button onclick="resetDealer()" class="w-full mt-3 py-3 bg-neon-amber/10 border border-neon-amber/50 text-neon-amber rounded-xl font-bold flex items-center justify-center gap-2 text-sm">
                <i data-lucide="layers" class="w-4 h-4"></i> NUEVO SHOE
            </button>
        </div>

        <!-- GAME SWITCHER FOOTER -->
        <div class="grid grid-cols-2 gap-2 mt-4">
            <button onclick="switchGame('roulette')" id="btn-mode-roulette" class="p-3 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan text-sm">RULETA</button>
            <button onclick="switchGame('baccarat')" id="btn-mode-baccarat" class="p-3 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 text-sm">BACCARAT</button>
        </div>

    </div>

    <!-- TOAST -->
    <div id="toast" class="toast bg-slate-800 border border-neon-cyan text-white font-bold text-sm"></div>

    <script>
        // --- ESTADO GLOBAL ---
        let state = {
            activeGame: 'roulette',
            roulette: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                level: 1,
                losses: 0,
                status: 'collecting', // collecting -> ghosting -> active
                ghostWins: 0,
                ghostTotal: 0,
                nextPrediction: null // La predicciÃ³n para el SIGUIENTE tiro
            },
            baccarat: {
                history: [],
                bankroll: { current: 1000, initial: 1000, target: 1500, stopLoss: 500 },
                step: 0,
                losses: 0,
                status: 'collecting',
                ghostWins: 0,
                ghostTotal: 0,
                nextPrediction: null
            }
        };

        const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        const SEQ_1324 = [1, 3, 2, 4];

        function init() {
            loadState();
            renderRouletteGrid();
            updateUI();
            lucide.createIcons();
        }

        // --- LÃ“GICA MATEMÃTICA PURA ---
        function calculatePrediction(game) {
            const s = game === 'roulette' ? state.roulette : state.baccarat;
            const hist = s.history;
            
            if (game === 'roulette') {
                // Algoritmo de Frecuencia Ponderada (Ãšltimos 37)
                const window = hist.slice(-37);
                const dozens = {1:0, 2:0, 3:0};
                
                // Peso: Los Ãºltimos 10 valen doble
                window.forEach((n, i) => {
                    if (n !== 0) {
                        const doz = getDozen(n);
                        const weight = i >= 27 ? 2 : 1;
                        dozens[doz] += weight;
                    }
                });

                // Encontrar la docena mÃ¡s caliente
                let best = 1;
                if (dozens[2] > dozens[1]) best = 2;
                if (dozens[3] > dozens[best]) best = 3;

                // Calcular confianza
                const totalWeight = window.length + 10; // Aprox
                const confidence = Math.min(95, Math.round((dozens[best] / totalWeight) * 100) + 20);

                return { val: best, conf: confidence, reason: `Tendencia D${best} (Peso: ${dozens[best]})` };

            } else {
                // Baccarat: Patrones
                const window = hist.slice(-20);
                const p = window.filter(x=>x==='P').length;
                const b = window.filter(x=>x==='B').length;
                
                // Detectar ZigZag
                let zigzags = 0;
                for(let i=1; i<window.length; i++) {
                    if(window[i] !== window[i-1]) zigzags++;
                }
                
                const last = window[window.length-1];
                let pred = last;
                let reason = "Seguir Racha";
                
                if (zigzags > window.length * 0.6) {
                    pred = last === 'P' ? 'B' : 'P';
                    reason = "PatrÃ³n ZigZag";
                } else if (b > p + 3) {
                    pred = 'B';
                    reason = "Dominio Banker";
                }

                return { val: pred, conf: 75, reason: reason };
            }
        }

        // --- REGISTRO DE DATOS ---
        function registerRoulette(num) {
            const s = state.roulette;
            
            // 1. Verificar predicciÃ³n ANTERIOR (si existÃ­a)
            if (s.nextPrediction !== null) {
                const dozen = getDozen(num);
                const won = dozen === s.nextPrediction.val;
                
                if (s.status === 'ghosting') {
                    s.ghostTotal++;
                    if (won) s.ghostWins++;
                    
                    // Evaluar fin de Ghosting (10 tiros)
                    if (s.ghostTotal >= 10) {
                        const rate = (s.ghostWins / s.ghostTotal) * 100;
                        if (rate >= 40) { // 40% en docenas es excelente
                            s.status = 'active';
                            showToast(`ðŸŽ¯ CALIBRADO: ${rate.toFixed(0)}% ACIERTO`, 'success');
                        } else {
                            showToast(`âš ï¸ BAJO ACIERTO (${rate.toFixed(0)}%). REINICIANDO`, 'error');
                            resetDealer();
                            return;
                        }
                    }
                } else if (s.status === 'active') {
                    const bet = calculateBetAmount(s, 'roulette');
                    if (won) {
                        s.bankroll.current += bet * 2;
                        s.level = Math.max(1, s.level - 1);
                        s.losses = 0;
                        showToast(`âœ… GANASTE +$${bet*2}`, 'success');
                    } else {
                        s.bankroll.current -= bet;
                        s.level = Math.min(10, s.level + 1);
                        s.losses++;
                        showToast(`âŒ PERDISTE -$${bet}`, 'error');
                        if (s.losses >= 3) {
                            s.status = 'ghosting'; // Volver a calibrar
                            s.ghostTotal = 0; s.ghostWins = 0;
                            showToast('âš ï¸ 3 FALLOS - RECALIBRANDO', 'warning');
                        }
                    }
                }
            }

            // 2. Agregar al historial
            s.history.push(num);
            if (s.history.length > 37) s.history.shift();

            // 3. TransiciÃ³n a Ghosting
            if (s.status === 'collecting' && s.history.length >= 37) {
                s.status = 'ghosting';
                s.ghostTotal = 0;
                s.ghostWins = 0;
                showToast("ðŸ‘» INICIANDO FASE FANTASMA", "info");
            }

            // 4. Generar NUEVA predicciÃ³n para el siguiente tiro
            if (s.status !== 'collecting') {
                s.nextPrediction = calculatePrediction('roulette');
            }

            saveState();
            updateUI();
        }

        function registerBaccarat(side) {
            const s = state.baccarat;
            
            if (s.nextPrediction !== null) {
                const won = side === s.nextPrediction.val;
                
                if (s.status === 'ghosting') {
                    s.ghostTotal++;
                    if (won) s.ghostWins++;
                    if (s.ghostTotal >= 10) {
                        if ((s.ghostWins/s.ghostTotal) >= 0.6) {
                            s.status = 'active';
                            showToast("âœ… CALIBRADO", 'success');
                        } else {
                            resetDealer();
                            return;
                        }
                    }
                } else if (s.status === 'active') {
                    const bet = calculateBetAmount(s, 'baccarat');
                    if (won) {
                        s.bankroll.current += bet;
                        s.step = (s.step + 1) % 4;
                        s.losses = 0;
                        showToast(`âœ… GANASTE`, 'success');
                    } else if (side !== 'T') {
                        s.bankroll.current -= bet;
                        s.step = 0;
                        s.losses++;
                        showToast(`âŒ PERDISTE`, 'error');
                        if (s.losses >= 3) {
                            s.status = 'ghosting'; s.ghostTotal = 0; s.ghostWins = 0;
                            showToast('âš ï¸ RECALIBRANDO', 'warning');
                        }
                    }
                }
            }

            s.history.push(side);
            if (s.history.length > 20) s.history.shift();

            if (s.status === 'collecting' && s.history.length >= 15) {
                s.status = 'ghosting'; s.ghostTotal = 0; s.ghostWins = 0;
            }

            if (s.status !== 'collecting') {
                s.nextPrediction = calculatePrediction('baccarat');
            }

            saveState();
            updateUI();
        }

        // --- UTILS ---
        function calculateBetAmount(s, game) {
            const baseUnit = s.bankroll.current * 0.01;
            if (game === 'roulette') return Math.floor(baseUnit * s.level);
            return Math.floor(baseUnit * SEQ_1324[s.step % 4]);
        }

        function getDozen(n) { return n === 0 ? 0 : n <= 12 ? 1 : n <= 24 ? 2 : 3; }
        function switchGame(mode) { state.activeGame = mode; updateUI(); }
        
        function resetDealer() {
            if(!confirm("Â¿Cambio de Crupier?")) return;
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.history = []; s.status = 'collecting'; s.nextPrediction = null;
            updateUI();
        }

        function updateUI() {
            const isRoul = state.activeGame === 'roulette';
            const s = isRoul ? state.roulette : state.baccarat;
            const target = isRoul ? 37 : 15;

            // Visibilidad
            document.getElementById('game-roulette').classList.toggle('hidden', !isRoul);
            document.getElementById('game-baccarat').classList.toggle('hidden', isRoul);
            document.getElementById('prediction-panel').classList.toggle('hidden', s.status === 'collecting');

            // Botones Modo
            document.getElementById('btn-mode-roulette').className = isRoul ? "p-3 rounded-xl font-bold border border-neon-cyan bg-neon-cyan/10 text-neon-cyan text-sm" : "p-3 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 text-sm";
            document.getElementById('btn-mode-baccarat').className = !isRoul ? "p-3 rounded-xl font-bold border border-neon-emerald bg-neon-emerald/10 text-neon-emerald text-sm" : "p-3 rounded-xl font-bold border border-white/10 bg-white/5 text-gray-500 text-sm";

            // Stats
            document.getElementById('game-mode-label').innerText = `SISTEMA ${state.activeGame.toUpperCase()}`;
            document.getElementById('display-balance').innerText = `$${s.bankroll.current.toFixed(0)}`;
            document.getElementById('display-target').innerText = `$${s.bankroll.target}`;
            document.getElementById('display-stop').innerText = `$${s.bankroll.stopLoss}`;
            
            const bet = calculateBetAmount(s, state.activeGame);
            document.getElementById('display-bet').innerText = s.status === 'active' ? `$${bet}` : '$0 (Ghost)';
            document.getElementById('display-bet').className = s.status === 'active' ? "text-2xl font-bold text-neon-emerald" : "text-2xl font-bold text-gray-500";
            document.getElementById('display-strategy-name').innerText = isRoul ? `D'Alembert Nivel ${s.level}` : `1-3-2-4 Paso ${s.step + 1}`;

            // Estado
            let statusText = "", progress = 0, colorClass = "text-gray-400";
            if (s.status === 'collecting') {
                statusText = `RECOLECTANDO (${s.history.length}/${target})`;
                progress = (s.history.length / target) * 100;
                colorClass = "text-neon-cyan";
            } else if (s.status === 'ghosting') {
                statusText = `FANTASMA (${s.ghostTotal}/10)`;
                progress = (s.ghostTotal / 10) * 100;
                colorClass = "text-neon-amber";
            } else {
                statusText = "FUEGO REAL";
                progress = 100;
                colorClass = "text-neon-emerald";
            }

            document.getElementById('status-text').innerText = statusText;
            document.getElementById('status-text').className = `font-bold ${colorClass}`;
            document.getElementById('progress-text').innerText = `${Math.round(progress)}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-bar').className = `h-full transition-all duration-300 ${s.status === 'active' ? 'bg-neon-emerald' : s.status === 'ghosting' ? 'bg-neon-amber' : 'bg-neon-cyan'}`;

            // Prediction Panel
            if (s.nextPrediction) {
                const predText = isRoul ? `DOCENA ${s.nextPrediction.val}` : (s.nextPrediction.val === 'P' ? 'PLAYER' : 'BANKER');
                document.getElementById('pred-main').innerText = predText;
                document.getElementById('pred-confidence').innerText = s.nextPrediction.conf + '%';
                document.getElementById('pred-reason').innerText = s.nextPrediction.reason;
                document.getElementById('pred-ghost-stats').innerText = `${s.ghostWins}/${s.ghostTotal}`;
                
                document.getElementById('phase-badge').innerText = s.status === 'active' ? 'APUESTA REAL' : 'FANTASMA';
                document.getElementById('phase-badge').className = `text-[10px] px-2 py-1 rounded font-bold ${s.status === 'active' ? 'bg-neon-emerald/20 text-neon-emerald' : 'bg-neon-amber/20 text-neon-amber'}`;
            }

            renderHistory(s.history, isRoul);
        }

        function renderRouletteGrid() {
            const grid = document.getElementById('roulette-grid');
            grid.innerHTML = `<button onclick="registerRoulette(0)" class="col-span-6 h-10 rounded bg-emerald-900/50 border border-emerald-500/30 text-emerald-400 font-bold btn-grid">0</button>`;
            for (let i = 1; i <= 36; i++) {
                const color = REDS.includes(i) ? 'red-num' : 'black-num';
                grid.innerHTML += `<button onclick="registerRoulette(${i})" class="h-12 rounded font-bold text-lg btn-grid ${color}">${i}</button>`;
            }
        }

        function renderHistory(hist, isRoul) {
            const container = document.getElementById(isRoul ? 'roulette-history' : 'baccarat-history');
            container.innerHTML = '';
            hist.slice().reverse().slice(0, 20).forEach(val => {
                let colorClass = 'bg-gray-700';
                if (isRoul) {
                    if (val === 0) colorClass = 'bg-emerald-600';
                    else if (REDS.includes(val)) colorClass = 'bg-red-600';
                } else {
                    if (val === 'P') colorClass = 'bg-blue-600';
                    else if (val === 'B') colorClass = 'bg-red-600';
                    else colorClass = 'bg-emerald-600';
                }
                container.innerHTML += `<div class="min-w-[30px] h-8 flex items-center justify-center text-xs font-bold rounded ${colorClass} text-white">${val}</div>`;
            });
        }

        function saveState() { localStorage.setItem('neon_v15', JSON.stringify(state)); }
        function loadState() {
            const saved = localStorage.getItem('neon_v15');
            if (saved) state = JSON.parse(saved);
        }
        function toggleSettings() { document.getElementById('settings-panel').classList.toggle('hidden'); }
        function saveSettings() {
            const s = state.activeGame === 'roulette' ? state.roulette : state.baccarat;
            s.bankroll.initial = parseFloat(document.getElementById('input-initial').value) || s.bankroll.initial;
            s.bankroll.current = s.bankroll.initial;
            s.bankroll.target = parseFloat(document.getElementById('input-target').value) || s.bankroll.target;
            s.bankroll.stopLoss = parseFloat(document.getElementById('input-stop').value) || s.bankroll.stopLoss;
            toggleSettings();
            saveState();
            updateUI();
            showToast("ConfiguraciÃ³n Guardada");
        }
        function showToast(msg, type='success') {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            t.style.borderColor = type === 'error' ? '#ff0055' : type === 'warning' ? '#ffb800' : '#00ffa3';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        init();
    </script>
</body>
</html>
